<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Use | Theengs gateway</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="apple-touch-icon" sizes="180x180" href=".apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#3eaf7c">
    <meta name="description" content="Multi platform MQTT BLE gateway leveraging Theengs Decoder">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileImage" content="/favicon-144x144.png">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.25df7dd7.css" as="style"><link rel="preload" href="/assets/js/app.478cd27f.js" as="script"><link rel="preload" href="/assets/js/2.b69705b6.js" as="script"><link rel="preload" href="/assets/js/7.5ccfcfa1.js" as="script"><link rel="prefetch" href="/assets/js/10.a9fcd3aa.js"><link rel="prefetch" href="/assets/js/11.2dc14f89.js"><link rel="prefetch" href="/assets/js/12.ec764436.js"><link rel="prefetch" href="/assets/js/13.2d8dcd68.js"><link rel="prefetch" href="/assets/js/14.196d1e6e.js"><link rel="prefetch" href="/assets/js/15.46e6e686.js"><link rel="prefetch" href="/assets/js/16.6b5df744.js"><link rel="prefetch" href="/assets/js/3.6ece99ce.js"><link rel="prefetch" href="/assets/js/4.fc17415b.js"><link rel="prefetch" href="/assets/js/5.68962aa8.js"><link rel="prefetch" href="/assets/js/6.60303aca.js"><link rel="prefetch" href="/assets/js/8.e251c2b9.js"><link rel="prefetch" href="/assets/js/9.a266250a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.25df7dd7.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Theengs gateway</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://shop.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Shop🆕
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.theengs.io" target="_self" class="nav-link external">
  Home
  <!----></a></div><div class="nav-item"><a href="https://app.theengs.io" target="_self" class="nav-link external">
  App
  <!----></a></div><div class="nav-item"><a href="https://gateway.theengs.io" target="_self" class="nav-link external">
  Gateway
  <!----></a></div><div class="nav-item"><a href="https://decoder.theengs.io" target="_self" class="nav-link external">
  Decoder
  <!----></a></div> <a href="https://github.com/theengs/gateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://shop.theengs.io/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Shop🆕
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://www.theengs.io" target="_self" class="nav-link external">
  Home
  <!----></a></div><div class="nav-item"><a href="https://app.theengs.io" target="_self" class="nav-link external">
  App
  <!----></a></div><div class="nav-item"><a href="https://gateway.theengs.io" target="_self" class="nav-link external">
  Gateway
  <!----></a></div><div class="nav-item"><a href="https://decoder.theengs.io" target="_self" class="nav-link external">
  Decoder
  <!----></a></div> <a href="https://github.com/theengs/gateway" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/" aria-current="page" class="sidebar-link">0 - What is it for 🏠</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>1 - Prerequisites🧭</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/install/install.html" class="sidebar-link">2 - Install ✔️</a></li><li><a href="/use/use.html" aria-current="page" class="active sidebar-link">3 - Use ✈️</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/use/use.html#launching-the-gateway" class="sidebar-link">Launching the gateway</a></li><li class="sidebar-sub-header"><a href="/use/use.html#details-options" class="sidebar-link">Details options</a></li><li class="sidebar-sub-header"><a href="/use/use.html#publish-to-a-2-levels-topic" class="sidebar-link">Publish to a 2 levels topic</a></li><li class="sidebar-sub-header"><a href="/use/use.html#scan-every-55s" class="sidebar-link">Scan every 55s</a></li><li class="sidebar-sub-header"><a href="/use/use.html#configuration-record" class="sidebar-link">Configuration record</a></li><li class="sidebar-sub-header"><a href="/use/use.html#mqtttomqtt-decoding" class="sidebar-link">MQTTtoMQTT decoding</a></li><li class="sidebar-sub-header"><a href="/use/use.html#home-assistant-auto-discovery" class="sidebar-link">Home Assistant auto discovery</a></li><li class="sidebar-sub-header"><a href="/use/use.html#passive-scanning" class="sidebar-link">Passive scanning</a></li><li class="sidebar-sub-header"><a href="/use/use.html#time-synchronization" class="sidebar-link">Time synchronization</a></li></ul></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>4 - Participate 💻</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="use"><a href="#use" class="header-anchor">#</a> Use</h1> <h2 id="launching-the-gateway"><a href="#launching-the-gateway" class="header-anchor">#</a> Launching the gateway</h2> <h3 id="for-a-regular-installation"><a href="#for-a-regular-installation" class="header-anchor">#</a> For a regular installation</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>python -m TheengsGateway -H <span class="token string">&quot;&lt;mqtt_broker_host_ip&gt;&quot;</span> -u <span class="token string">&quot;username&quot;</span> -p <span class="token string">&quot;password&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="for-a-docker-container"><a href="#for-a-docker-container" class="header-anchor">#</a> For a Docker container</h3> <p>To run it with minimum required parameters required:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run --rm <span class="token punctuation">\</span>
    --network <span class="token function">host</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_HOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>mqtt_broker_host_ip<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -v /var/run/dbus:/var/run/dbus <span class="token punctuation">\</span>
    --name TheengsGateway <span class="token punctuation">\</span>
    theengs/gateway
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>If your mqtt broker is installed on the same instance as the gateway you can use <code>localhost</code> as the <code>&lt;mqtt_broker_host_ip&gt;</code>.</p></div> <h3 id="checking-the-data-published-by-the-gateway"><a href="#checking-the-data-published-by-the-gateway" class="header-anchor">#</a> Checking the data published by the gateway</h3> <p>Once the command launched you should see MQTT payloads appearing on the broker. To visualize these data you have to use an <a href="../prerequisites/broker">MQTT client tool</a>.</p> <p><img src="/assets/img/TheengsGateway_mqtt_explorer.beabd93e.png" alt="mqtt"></p> <p>Example payload received:</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span><span class="token property">&quot;name&quot;</span><span class="token operator">:</span><span class="token string">&quot;F35285&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;F3:52:85&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;rssi&quot;</span><span class="token operator">:</span><span class="token number">-82</span><span class="token punctuation">,</span><span class="token property">&quot;brand&quot;</span><span class="token operator">:</span><span class="token string">&quot;BlueMaestro&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;model&quot;</span><span class="token operator">:</span><span class="token string">&quot;TempoDisc&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;model_id&quot;</span><span class="token operator">:</span><span class="token string">&quot;BM_V23&quot;</span><span class="token punctuation">,</span><span class="token property">&quot;tempc&quot;</span><span class="token operator">:</span><span class="token number">24.1</span><span class="token punctuation">,</span><span class="token property">&quot;tempf&quot;</span><span class="token operator">:</span><span class="token number">75.38</span><span class="token punctuation">,</span><span class="token property">&quot;hum&quot;</span><span class="token operator">:</span><span class="token number">104.7</span><span class="token punctuation">,</span><span class="token property">&quot;dp&quot;</span><span class="token operator">:</span><span class="token number">24.8</span><span class="token punctuation">,</span><span class="token property">&quot;volt&quot;</span><span class="token operator">:</span><span class="token number">2.56</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="details-options"><a href="#details-options" class="header-anchor">#</a> Details options</h2> <h3 id="for-a-regular-installation-2"><a href="#for-a-regular-installation-2" class="header-anchor">#</a> For a regular installation</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>C:<span class="token punctuation">\</span>Users<span class="token punctuation">\</span>1technophile<span class="token operator">&gt;</span>python -m TheengsGateway -h
usage: -m <span class="token punctuation">[</span>-h<span class="token punctuation">]</span> <span class="token punctuation">[</span>-H HOST<span class="token punctuation">]</span> <span class="token punctuation">[</span>-P PORT<span class="token punctuation">]</span> <span class="token punctuation">[</span>-u <span class="token environment constant">USER</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-p <span class="token environment constant">PWD</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-pt PUB_TOPIC<span class="token punctuation">]</span>
          <span class="token punctuation">[</span>-st SUB_TOPIC<span class="token punctuation">]</span> <span class="token punctuation">[</span>-pa PUBLISH_ALL<span class="token punctuation">]</span> <span class="token punctuation">[</span>-sd SCAN_DUR<span class="token punctuation">]</span> <span class="token punctuation">[</span>-tb TIME_BETWEEN<span class="token punctuation">]</span>
          <span class="token punctuation">[</span>-ll <span class="token punctuation">{</span>DEBUG,INFO,WARNING,ERROR,CRITICAL<span class="token punctuation">}</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>-Dt DISCOVERY_TOPIC<span class="token punctuation">]</span> <span class="token punctuation">[</span>-D DISCOVERY<span class="token punctuation">]</span> <span class="token punctuation">[</span>-Dh HASS_DISCOVERY<span class="token punctuation">]</span>
          <span class="token punctuation">[</span>-Dn DISCOVERY_DEVICE_NAME<span class="token punctuation">]</span> <span class="token punctuation">[</span>-Df DISCOVERY_FILTER <span class="token punctuation">[</span>DISCOVERY_FILTER <span class="token punctuation">..</span>.<span class="token punctuation">]</span><span class="token punctuation">]</span>
          <span class="token punctuation">[</span>-a ADAPTER<span class="token punctuation">]</span> <span class="token punctuation">[</span>-s <span class="token punctuation">{</span>active,passive<span class="token punctuation">}</span><span class="token punctuation">]</span>

optional arguments:
  -h, --help            show this <span class="token builtin class-name">help</span> message and <span class="token builtin class-name">exit</span>
  -H HOST, --host HOST  MQTT <span class="token function">host</span> address
  -P PORT, --port PORT  MQTT <span class="token function">host</span> port
  -u <span class="token environment constant">USER</span>, --user <span class="token environment constant">USER</span>  MQTT username
  -p <span class="token environment constant">PWD</span>, --pass <span class="token environment constant">PWD</span>    MQTT password
  -pt PUB_TOPIC, --pub_topic PUB_TOPIC
                        MQTT publish topic
  -st SUB_TOPIC, --sub_topic SUB_TOPIC
                        MQTT subscribe topic
  -pa PUBLISH_ALL, --publish_all PUBLISH_ALL
                        Enable<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or disable<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> publishing of all beacons
  -sd SCAN_DUR, --scan_duration SCAN_DUR
                        BLE scan duration <span class="token punctuation">(</span>seconds<span class="token punctuation">)</span>
  -tb TIME_BETWEEN, --time_between TIME_BETWEEN
                        Seconds to <span class="token function">wait</span> between scans
  -ll <span class="token punctuation">{</span>DEBUG,INFO,WARNING,ERROR,CRITICAL<span class="token punctuation">}</span>, --log_level <span class="token punctuation">{</span>DEBUG,INFO,WARNING,ERROR,CRITICAL<span class="token punctuation">}</span>
                        TheengsGateway log level
  -Dt DISCOVERY_TOPIC, --discovery-topic DISCOVERY_TOPIC
                        MQTT Discovery topic
  -D DISCOVERY, --discovery DISCOVERY
                        Enable<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or disable<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> MQTT discovery
  -Dh HASS_DISCOVERY, --hass_discovery HASS_DISCOVERY
                        Enable<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> or disable<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> Home Assistant-specific MQTT
                        discovery <span class="token punctuation">(</span>default: <span class="token number">1</span><span class="token punctuation">)</span>                        
  -Dn DISCOVERY_DEVICE_NAME, --discovery_name DISCOVERY_DEVICE_NAME
                        Device name <span class="token keyword">for</span> Home Assistant
  -Df DISCOVERY_FILTER <span class="token punctuation">[</span>DISCOVERY_FILTER <span class="token punctuation">..</span>.<span class="token punctuation">]</span>, --discovery_filter DISCOVERY_FILTER <span class="token punctuation">[</span>DISCOVERY_FILTER <span class="token punctuation">..</span>.<span class="token punctuation">]</span>
                        Device discovery filter list <span class="token keyword">for</span> Home Assistant
  -a ADAPTER, --adapter ADAPTER
                        Bluetooth adapter <span class="token punctuation">(</span>e.g. hci1 on Linux<span class="token punctuation">)</span>
  -s <span class="token punctuation">{</span>active,passive<span class="token punctuation">}</span>, --scanning_mode <span class="token punctuation">{</span>active,passive<span class="token punctuation">}</span>
                        Scanning mode <span class="token punctuation">(</span>default: active<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><h3 id="for-a-docker-container-2"><a href="#for-a-docker-container-2" class="header-anchor">#</a> For a Docker container</h3> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">docker</span> run --rm <span class="token punctuation">\</span>
    --network <span class="token function">host</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_HOST</span><span class="token operator">=</span><span class="token operator">&lt;</span>host_ip<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_USERNAME</span><span class="token operator">=</span><span class="token operator">&lt;</span>username<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_PASSWORD</span><span class="token operator">=</span><span class="token operator">&lt;</span>password<span class="token operator">&gt;</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_PUB_TOPIC</span><span class="token operator">=</span>home/TheengsGateway/BTtoMQTT <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">MQTT_SUB_TOPIC</span><span class="token operator">=</span>home/+/BTtoMQTT/undecoded <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">PUBLISH_ALL</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">TIME_BETWEEN</span><span class="token operator">=</span><span class="token number">60</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">SCAN_TIME</span><span class="token operator">=</span><span class="token number">60</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">LOG_LEVEL</span><span class="token operator">=</span>DEBUG <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">HAAS_DISCOVERY</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DISCOVERY</span><span class="token operator">=</span>true <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DISCOVERY_TOPIC</span><span class="token operator">=</span>homeassistant/sensor <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DISCOVERY_DEVICE_NAME</span><span class="token operator">=</span>TheengsGateway <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DISCOVERY_FILTER</span><span class="token operator">=</span><span class="token string">&quot;[IBEACON,GAEN,MS-CDP]&quot;</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">SCANNING_MODE</span><span class="token operator">=</span>active
    -e <span class="token assign-left variable">ADAPTER</span><span class="token operator">=</span>hci0 <span class="token punctuation">\</span>
    -v /var/run/dbus:/var/run/dbus <span class="token punctuation">\</span>
    --name TheengsGateway <span class="token punctuation">\</span>
    theengs/gateway
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="publish-to-a-2-levels-topic"><a href="#publish-to-a-2-levels-topic" class="header-anchor">#</a> Publish to a 2 levels topic</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>python -m TheengsGateway -H <span class="token string">&quot;192.168.1.17&quot;</span> -u <span class="token string">&quot;username&quot;</span> -p <span class="token string">&quot;password&quot;</span> -pt <span class="token string">&quot;home/TheengsGateway&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="scan-every-55s"><a href="#scan-every-55s" class="header-anchor">#</a> Scan every 55s</h2> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>python -m TheengsGateway -H <span class="token string">&quot;192.168.1.17&quot;</span> -u <span class="token string">&quot;username&quot;</span> -p <span class="token string">&quot;password&quot;</span> -pt <span class="token string">&quot;home/TheengsGateway&quot;</span> -tb <span class="token number">55</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="configuration-record"><a href="#configuration-record" class="header-anchor">#</a> Configuration record</h2> <p>Once you have entered your credentials and parameters they are saved into a configuration file <code>theengsgw.conf</code> into your user directory and you can simply launch the gateway by using:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>python -m TheengsGateway
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h2 id="mqtttomqtt-decoding"><a href="#mqtttomqtt-decoding" class="header-anchor">#</a> MQTTtoMQTT decoding</h2> <p>Messages sent to the subscribe topic can be used for decoding BLE data and will be published to the publish topic. This allows for offloading the decode operation from other devices, such as an ESP32, to enhance performance.</p> <p>The data sent to the topic is expected to be formatted in JSON and MUST have at least an &quot;id&quot; entry.</p> <p>Example message:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>{
  &quot;id&quot;:&quot;54:94:5E:9F:64:C4&quot;,
  &quot;mac_type&quot;:1,
  &quot;manufacturerdata&quot;:&quot;4c0010060319247bbc68&quot;,
  &quot;rssi&quot;:-74,
  &quot;txpower&quot;:12
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>If possible, the data will be decoded and published.</p> <p><a href="https://docs.openmqttgateway.com/" target="_blank" rel="noopener noreferrer">OpenMQTTGateway<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, proposes a <a href="https://docs.openmqttgateway.com/upload/web-install.html" target="_blank" rel="noopener noreferrer">web upload<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> binary <code>esp32dev-ble-mqtt-undecoded</code> that will publish directly to 'home/<gateway name="">/BTtoMQTT` making it directly compatible with Theengs Gateway MQTTtoMQTT decoding feature.</gateway></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>By default Theengs Gateway will listen to <code>home/+/BTtoMQTT/undecoded</code>, if you have several ESP32 gateways with OpenMQTTGateway undecoded, Theengs will pickup all of them and centralize the decoded BT sensor data in one place.</p></div> <h2 id="home-assistant-auto-discovery"><a href="#home-assistant-auto-discovery" class="header-anchor">#</a> Home Assistant auto discovery</h2> <p>If enabled (default), decoded devices will publish their configuration to Home Assistant to be discovered.</p> <ul><li>This can be enabled/disabled with the <code>-D</code> or <code>--discovery</code> command line argument with a value of 1 (enable) or 0 (disable).</li> <li>If you want to use Home Assistant discovery with other home automation gateways such as openHAB, set <code>-Dh</code> or <code>--hass_discovery</code> to 0 (disable).</li> <li>The discovery topic can be set with the <code>-Dt</code> or <code>--discovery_topic</code> command line argument.</li> <li>The discovery name can be set wit the <code>-Dn</code> or <code>--discovery_name</code> command line argument.</li> <li>Devices can be filtered from discovery with the <code>-Df</code> or <code>--discovery_filter</code> argument which takes a list of device &quot;model_id&quot; to be filtered.</li></ul> <p>The <code>IBEACON</code>, <code>GAEN</code> and <code>MS-CDP</code> devices are already filtered as their addresses (id's) change over time resulting in multiple discoveries.</p> <h2 id="passive-scanning"><a href="#passive-scanning" class="header-anchor">#</a> Passive scanning</h2> <p>Passive scanning (<code>-s passive</code> or <code>--scanning_mode passive</code>) only works on Windows or Linux kernel &gt;= 5.10 and BlueZ &gt;= 5.56 with experimental features enabled.</p> <p>To enable experimental features in BlueZ on a Linux distribution that uses systemd, run the following command:</p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token function">sudo</span> systemctl edit bluetooth.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>Then add the following lines:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>[Service]
ExecStart=
ExecStart=/usr/lib/bluetooth/bluetoothd --experimental
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>Save and close the file and then run the following commands:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo systemctl daemon-reload
sudo systemctl restart bluetooth.service
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h2 id="time-synchronization"><a href="#time-synchronization" class="header-anchor">#</a> Time synchronization</h2> <p>If the gateway finds LYWSD02 devices, it automatically synchronizes their time once a day. Therefore, make sure that your gateway's time is set correctly.</p></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/theengs/gateway/edit/development/docs/use/use.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">1/13/2023, 2:44:55 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/install/install.html" class="prev">
        2 - Install ✔️
      </a></span> <span class="next"><a href="/participate/adding-decoders.html">
        Adding decoders
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.478cd27f.js" defer></script><script src="/assets/js/2.b69705b6.js" defer></script><script src="/assets/js/7.5ccfcfa1.js" defer></script>
  </body>
</html>
